<!DOCTYPE html>

<html>
<head>
  <title>quiz/script.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>

    <ul class="sections">

          <li id="title">
              <div class="annotation">
                  <h1>quiz/script.js</h1>
                  <a href="https://github.com/keighty/JSGames/blob/master/public/custom/quiz/script.js">View source</a>
              </div>
          </li>



        <li id="section-1">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>quiz/script.js contains all the implementation logic for AnimalQuiz,  inspired by challenge #4 of Ruby Quiz. The script tracks the user interaction and uses ajax to communicate with the persistence layer.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="comment">/**************
Variables
***************/</span>
<span class="keyword">var</span> start_question_id = <span class="number">1</span>,
    yes_path,
    no_path,
    question_text,
    question_id;

<span class="comment">/**************
Game Preparation
***************/</span>
$(<span class="keyword">function</span>() {</pre></div></div>

        </li>


        <li id="section-2">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Setting the forms to return false ensures that the page is not refreshed on submit.</p>

            </div>

            <div class="content"><div class='highlight'><pre>  $(<span class="string">'form'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="literal">false</span>;
  });
  $(<span class="string">'form'</span>).hide();</pre></div></div>

        </li>


        <li id="section-3">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>When the player is ready to play (ie. has thought of an animal), the game should move the hero unit and the ready button out of the way, and get the first question.</p>

            </div>

            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#ready_button'</span>).bind(<span class="string">'click'</span>, <span class="keyword">function</span>() {
    $(<span class="string">'.hero-unit'</span>).slideUp(<span class="number">500</span>);
    $(<span class="string">"#ready_button"</span>).hide();
    ask_question(start_question_id);
  });</pre></div></div>

        </li>


        <li id="section-4">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>When the player clicks the &quot;yes&quot; button, send the yes_path for processing</p>

            </div>

            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#yes_button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
    process_path(yes_path, <span class="string">'yes'</span>);
  });</pre></div></div>

        </li>


        <li id="section-5">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>When the player clicks on the &quot;no&quot; button, send the no_path for processing</p>

            </div>

            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#no_button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
    process_path(no_path, <span class="string">'no'</span>);
  });</pre></div></div>

        </li>


        <li id="section-6">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>When the player submits information about the animal, the game will send it on to the database.</p>

            </div>

            <div class="content"><div class='highlight'><pre>  $(<span class="string">'#submit'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>() {
    submit_learn_animal_form();
  });
});

<span class="comment">/**************
Game Play
***************/</span></pre></div></div>

        </li>


        <li id="section-7">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>When the user chooses a path, first check if the path is defined. If the path is defined, return the question, if not, the game has either guessed the correct animal and will gloat about it, or it will ask for more information.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> process_path = <span class="keyword">function</span>(path, path_name){
  <span class="keyword">if</span>(path){
    ask_question(path);
  } <span class="keyword">else</span> {
    <span class="keyword">if</span>(path_name == <span class="string">'yes'</span>){
      game_over();
    } <span class="keyword">else</span> {
      show_learn_animal_form();
    }
  }
};</pre></div></div>

        </li>


        <li id="section-8">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The game uses ajax to query the database for the next question. The game sends the id of the question it would like returned and forwards the response for further processing.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> ask_question = <span class="function"><span class="keyword">function</span> <span class="title">ask_question</span><span class="params">(next_question)</span>{</span>
  $.ajax({
    type: <span class="string">"POST"</span>,
    url: <span class="string">"http://"</span>+ window.location.host + <span class="string">"/animalquiz/ask"</span>,
    dataType: <span class="string">"json"</span>,
    data: { <span class="string">'id'</span> : next_question },
    complete: <span class="keyword">function</span>(data){
      process_json(data[<span class="string">'responseJSON'</span>]);
    }
  });
};</pre></div></div>

        </li>


        <li id="section-9">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>process_json() retrieves the interesting data from the json and update all the variables.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> process_json = <span class="keyword">function</span>(json) {
  question_id = json[<span class="string">'id'</span>];
  question_text = json[<span class="string">'question'</span>];
  yes_path = json[<span class="string">'yes'</span>];
  no_path = json[<span class="string">'no'</span>];

  display_next_question(question_text);
};</pre></div></div>

        </li>


        <li id="section-10">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>display_next_question() modifies and shows the question form and response buttons.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> display_next_question = <span class="function"><span class="keyword">function</span> <span class="title">display_next_question</span><span class="params">(display_text)</span> {</span>
  $(<span class="string">'.question_form h3'</span>).text(display_text);
  $(<span class="string">'.question_form a'</span>).show();
  $(<span class="string">'.question_form'</span>).show();
};</pre></div></div>

        </li>


        <li id="section-11">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>If the game has not guessed the user&#39;s animal, it would like to learn about it. It will hide the current_question form and display the new_question form.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="comment">/**************
Game Learns
***************/</span>
<span class="keyword">var</span> show_learn_animal_form = <span class="function"><span class="keyword">function</span> <span class="title">show_learn_animal_form</span><span class="params">()</span> {</span>
  $(<span class="string">'.question_form'</span>).hide();
  $(<span class="string">'.learn_animal_form'</span>).show();
};</pre></div></div>

        </li>


        <li id="section-12">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>The game submits the information provided by the user.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> submit_learn_animal_form = <span class="function"><span class="keyword">function</span> <span class="title">submit_learn_animal_form</span><span class="params">()</span> {</span>
  $.ajax({
    type: <span class="string">"POST"</span>,
    url: <span class="string">"http://"</span>+ window.location.host + <span class="string">"/animalquiz/learn"</span>,
    accepts: <span class="string">"application/json"</span>,
    dataType: <span class="string">"json"</span>,
    data: {
      <span class="string">'id'</span> : question_id,
      <span class="string">'animal'</span> : $(<span class="string">'#new_animal'</span>).val(),
      <span class="string">'question'</span> : $(<span class="string">'#new_question'</span>).val(),
      <span class="string">'answer'</span> : $(<span class="string">'input:checked'</span>, <span class="string">'.learn_animal_form'</span>).val() },
    complete: <span class="keyword">function</span>(data){</pre></div></div>

        </li>


        <li id="section-13">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>When the form is successfully submitted, it asks the user to play again</p>

            </div>

            <div class="content"><div class='highlight'><pre>      play_again();
      <span class="keyword">return</span> <span class="literal">false</span>;
    }
  });
};

<span class="comment">/**************
Game Over
***************/</span></pre></div></div>

        </li>


        <li id="section-14">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>When it has guessed the animal correctly, the game will hide the option buttons, boast about its guessing prowess, and ask if the user would like to play again.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> game_over = <span class="function"><span class="keyword">function</span> <span class="title">game_over</span><span class="params">()</span> {</span>
  $(<span class="string">'.question_form h3'</span>).text(<span class="string">"I win!"</span>);
  $(<span class="string">'.question_form a'</span>).hide();
  play_again();
};</pre></div></div>

        </li>


        <li id="section-15">
            <div class="annotation">

              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The game and forms are reset and asks if the user would like to play again.</p>

            </div>

            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> play_again = <span class="function"><span class="keyword">function</span> <span class="title">play_again</span><span class="params">()</span> {</span>
  $(<span class="string">"#ready_button"</span>).show().appendTo(<span class="string">'.container'</span>).text(<span class="string">"Play Again?"</span>);
  $(<span class="string">'.learn_animal_form'</span>).trigger(<span class="string">"reset"</span>).hide();
};</pre></div></div>

        </li>

    </ul>
  </div>
</body>
</html>
